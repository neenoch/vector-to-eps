<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potrace.js Color Changer</title>
    <style>
        #svg-container svg {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <input type="file" id="imageInput" accept="image/*">
    <div id="svg-container"></div>
    <div id="color-controls"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/potrace/1.16.0/potrace.min.js"></script>
    <script>
        const imageInput = document.getElementById('imageInput');
        const svgContainer = document.getElementById('svg-container');
        const colorControls = document.getElementById('color-controls');

        imageInput.addEventListener('change', handleImage);

        function handleImage(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const potrace = window.Potrace.create();
                    potrace.setParameters({
                        threshold: 128,
                        turdSize: 2,
                        alphaMax: 1,
                        optCurve: true,
                        optTolerance: 0.2,
                        turnPolicy: Potrace.TURNPOLICY_MINORITY
                    });

                    potrace.loadImageData(imageData);
                    const svg = potrace.getSVG(1);

                    svgContainer.innerHTML = svg;

                    const paths = svgContainer.querySelectorAll('path');
                    paths.forEach((path, index) => {
                        path.id = `path-${index}`;
                        const colorInput = document.createElement('input');
                        colorInput.type = 'color';
                        colorInput.id = `color-${index}`;
                        colorInput.addEventListener('input', () => {
                            path.style.fill = colorInput.value;
                        });
                        colorControls.appendChild(colorInput);
                    });
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
